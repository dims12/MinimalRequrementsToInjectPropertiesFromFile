This branch uses outer class for configuration ans still does not working.